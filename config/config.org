* Use-package
Automatically install certain packages, as well as the ease of lazily loading them
#+BEGIN_SRC emacs-lisp
  (unless (package-installed-p 'use-package) ;; if not..
    (package-refresh-contents)
    (package-install 'use-package))

  (eval-when-compile
    (require 'use-package))

  (require 'use-package-ensure)
  (setq use-package-always-ensure t) ;; instead of putting ':ensure' everywhere
#+END_SRC
* Packages update
*slows down the startup A LOT*
#+BEGIN_SRC emacs-lisp
  ;; (use-package auto-package-update
  ;;   :config
  ;;   (setq auto-package-update-delete-old-versions t)
  ;;   (setq auto-package-update-hide-results t)
  ;;   (auto-package-update-maybe))
#+END_SRC

* Evil
** evil itself
#+BEGIN_SRC emacs-lisp
  (use-package evil
    :init (evil-mode t)
    :bind ("C-f" . evil-normal-state)
    :config
    ;; brings cursor at the middle of the screen after pressing 'n' in evil-mode
    (defadvice evil-ex-search-next (after advice-for-evil-ex-search-next activate)
      (evil-scroll-line-to-center (line-number-at-pos))))
#+END_SRC
** evil-leader
#+BEGIN_SRC emacs-lisp
  (use-package evil-leader
    :init
    (global-evil-leader-mode)
    (evil-leader/set-leader ",")
    :config
    (setq evil-leader/in-all-states 1
          ;; Change cursor color depending on mode (only GUI emacs)
          evil-emacs-state-cursor '("cyan" box)
          evil-normal-state-cursor '("cyan" box)
          evil-visual-state-cursor '("orange" box)
          evil-insert-state-cursor '("green" bar)
          evil-replace-state-cursor '("red" bar)
          evil-operator-state-cursor '("cyan" hollow)))
#+END_SRC

** evil Multiple-Cursors | [[https://github.com/gabesoft/evil-mc][github]]
#+BEGIN_SRC emacs-lisp
  (use-package evil-mc :diminish
    :init
    (global-evil-mc-mode 1)
    (evil-define-key 'visual evil-mc-key-map
      "A" #'evil-mc-make-cursor-in-visual-selection-end
      "I" #'evil-mc-make-cursor-in-visual-selection-beg))

  (evil-leader/set-key
    "ma" 'evil-mc-make-all-cursors
    "mz" 'evil-mc-undo-all-cursors
    "mn" 'evil-mc-make-and-goto-next-match
    "mp" 'evil-mc-make-and-goto-prev-match
    "mf" 'evil-mc-skip-and-goto-next-match
    "mb" 'evil-mc-skip-and-goto-prev-match
    "mu" 'evil-mc-undo-last-added-cursor)
#+END_SRC

* Environment
** Identation
I have learned to distrust tabs in my source code, so let’s make sure
that we only have spaces. See this [[http://ergoemacs.org/emacs/emacs_tabs_space_indentation_setup.html][discussion]] for details.
#+BEGIN_SRC emacs-lisp
  (setq-default indent-tabs-mode nil)
  (setq tab-width 2)

  ;; make return key also do indent, globally (test)
  (electric-indent-mode 1)

  ;; Make tab key do indent first then completion.
  (setq-default tab-always-indent 'complete)
#+END_SRC

** Major settings
#+BEGIN_SRC emacs-lisp
  (setq fill-column 110
        x-select-enable-clipboard t ;; paste - look for shortcut
        make-backup-files nil ;; disable backup files
        auto-save-default nil ;; disable auto-save files
        disabled-command-function nil ;; no need to re-enable each feature bit-by-bit:
        ;; Misc
        echo-keystrokes 0.1 ;; Turn down the time to echo keystrokes
        visible-bell t ;; Get rid of the beeps
        use-dialog-box nil ;; use the echo area instead of dialog boxes
        visible-bell t) ;; Use a visual indicator instead of making horrible noises

  (defalias 'yes-or-no-p 'y-or-n-p) ;; Yes and No prompt

  ;; Vendor directory (for manually installed packages)
  (defvar sads/vendor-dir (expand-file-name "vendor" user-emacs-directory))
  (add-to-list 'load-path sads/vendor-dir)

  (dolist (project (directory-files sads/vendor-dir t "\\w+"))
  (when (file-directory-p project)
      (add-to-list 'load-path project)))
#+END_SRC

** Init file support
#+BEGIN_SRC emacs-lisp
  (require 'cl-lib) ;; new library for common-lib compatability (cl - old)

  (use-package dash
    :config (eval-after-load "dash" '(dash-enable-font-lock)))

  (use-package s)
  (use-package f)
#+END_SRC
** Hooks
#+BEGIN_SRC emacs-lisp
  (add-hook 'before-save-hook 'delete-trailing-whitespace) ;; always strip trailing whitespace

  ;; === linum and fringe ===
  (add-hook 'prog-mode-hook 'linum-mode)
  (add-hook 'prog-mode-hook 'hs-minor-mode)
  ;; (global-linum-mode 1)
  (add-hook 'prog-mode-hook 'fringe-mode '(8 . 0)) ;; dunno if that'll work
  (add-hook 'linum-mode-hook (lambda () (set-face-attribute 'linum nil :height 110))) ;; dunno what it does

  (add-hook 'compilation-filter-hook 'colorize-compilation-buffer) ;; dunno if i need it
  (add-hook 'markdown-mode-hook 'auto-fill-mode)

  ;; Various keywords (in comments) are now flagged in a Red Error font
  (add-hook 'prog-common-hook
            (lambda ()
              (font-lock-add-keywords nil
                                      '(("\\<\\(FIX\\|FIXME\\|TODO\\|BUG\\|HACK\\):" 1 font-lock-warning-face t)))))
#+END_SRC
** Modes
#+BEGIN_SRC emacs-lisp
  ;; marking text
  (delete-selection-mode t)
  (transient-mark-mode t)

  (desktop-save-mode 1) ;; automatically save/restore sessions

  (global-prettify-symbols-mode t) ;; type 'lambda' to understand

  (save-place-mode 1) ;; save cursor position when u quit file
  (setq save-place-forget-unreadable-files t) ;; set to nil if something will work slow

  (global-subword-mode 1) ;; move in camelCase

  (global-auto-revert-mode nil)

  ;; shell-script-mode
  (add-to-list 'auto-mode-alist '("\\.zsh$" . shell-script-mode))

  ;; conf-mode
  (add-to-list 'auto-mode-alist '("\\.gitconfig$" . conf-mode))
  (add-to-list 'auto-mode-alist '("\\.gitignore$" . conf-mode))
#+END_SRC

** Keybindings
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-;") 'comment-or-uncomment-region)
  (global-set-key (kbd "C-<tab>") 'dabbrev-expand)
  (define-key minibuffer-local-map (kbd "C-<tab>") 'dabbrev-expand)
  (global-set-key (kbd "<mouse-2>") 'clipboard-yank) ;; paste from clipboard by middle mouse button
#+END_SRC

** Navigation
#+BEGIN_SRC emacs-lisp
  (setq ibuffer-expert t)
#+END_SRC
#+BEGIN_SRC emacs-lisp
  (evil-leader/set-key
    "w" 'save-buffer
    "bd" 'kill-buffer
    "bm" 'ibuffer
    "bo" 'switch-to-buffer)

  (global-set-key (kbd "C-c p") 'mode-line-other-buffer)
#+END_SRC

** Not used / unknown purpose
   #+BEGIN_SRC emacs-lisp
     ;; (setq backup-directory-alist `((".*" . ,temporary-file-directory)))
     ;; (setq auto-save-file-name-transforms `((".*" ,temporary-file-directory t)))

     ;; Allow confusing functions
     (put 'narrow-to-region 'disabled nil)
   #+END_SRC


* Appearance
** Packages
*** Spacemacs-theme
#+BEGIN_SRC emacs-lisp
  (use-package spacemacs-common
      :ensure spacemacs-theme
      :config (load-theme 'spacemacs-dark t))
#+END_SRC

*** Rainbow
#+BEGIN_SRC emacs-lisp
  (use-package rainbow-mode :diminish
    :hook prog-mode
    :config
    (use-package rainbow-delimiters
      :hook (prog-mode . rainbow-delimiters-mode)))
#+END_SRC

*** Dashboard
#+BEGIN_SRC emacs-lisp
  (use-package dashboard
    :config
    (dashboard-setup-startup-hook)
    (setq dashboard-items '((recents . 10))
          dashboard-banner-logo-title "Yo, me"))
#+END_SRC

*** Avy
#+BEGIN_SRC emacs-lisp
  (use-package avy
    :init (setq avy-background t)
    :config
    (evil-leader/set-key "SPC" 'avy-goto-char))
#+END_SRC

*** Spaceline / Powerline
#+BEGIN_SRC emacs-lisp
  ;; (use-package powerline
  ;;   :init (powerline-default-theme))

  (use-package spaceline
    :config
    (use-package diminish
      :init
      (diminish 'undo-tree-mode)
      (diminish 'subword-mode))
    (require 'spaceline-config)
    (setq powerline-default-separator (quote arrow))
    (spaceline-spacemacs-theme))
#+END_SRC

** Display settings
#+BEGIN_SRC emacs-lisp
  ;; Splash Screen
  (setq inhibit-splash-screen t
        initial-scratch-message nil
        initial-major-mode 'org-mode)

  ;; Scroll-, tool-, menu bars*
  (menu-bar-mode -1)
  (when (window-system)
    (tool-bar-mode 0) ;; Toolbars were only cool with XEmacs
    (when (fboundp 'horizontal-scroll-bar-mode)
      (horizontal-scroll-bar-mode -1))
    (scroll-bar-mode -1)) ;; Scrollbars are waste screen estate

  ;; (if window-system (toggle-scroll-bar -1))
#+END_SRC

** Other visual settings
#+BEGIN_SRC emacs-lisp
  (setq-default indicate-empty-lines t)
  (when (not indicate-empty-lines)
  (toggle-indicate-empty-lines))

  (show-paren-mode t) ;; highlight parentheses
#+END_SRC
** Not used / known
   #+BEGIN_SRC emacs-lisp
     ;; when in GUI - highlight the line with the cursor
     ;; didn't enable cuz of the comment line highlighting in emacs theme
     ;; (when window-system (global-hl-line-mode t))

     ;; Color Codes
     (require 'ansi-color)
     (defun colorize-compilation-buffer ()
       (toggle-read-only)
       (ansi-color-apply-on-region (point-min) (point-max))
       (toggle-read-only))
   #+END_SRC


* Build-in pkgs
** Dired
#+BEGIN_SRC emacs-lisp
  (setq dired-dwim-target t)
  (put 'dired-find-alternate-file 'disabled nil)

  (use-package find-dired
     :init (setq find-ls-option '("-print0 | xargs -0 ls -od" . "-od")))
  ;; (setq find-ls-option '("-print0 | xargs -0 ls -ld" . "-ld")) -- ld / od??

  (use-package peep-dired
    :defer t ; don't access `dired-mode-map' until `peep-dired' is loaded
    :bind (:map dired-mode-map
                ("P" . peep-dired)))

  ;; ---

  (require 'dired-x)
  (setq dired-omit-files "^\\.?#\\|^\\.[^.].*")

  (defun air-dired-buffer-dir-or-home ()
    "Open dired to the current buffer's dir, or $HOME."
    (interactive)
    (let ((cwd (or (file-name-directory (or (buffer-file-name) ""))
                   (expand-file-name "~"))))
      (dired cwd)))

  (add-hook 'dired-mode-hook (lambda ()
                               (dired-omit-mode t)))

  (eval-after-load 'wdired
    (add-hook 'wdired-mode-hook 'evil-normal-state))
#+END_SRC

* ORG
[[https://github.com/howardabrams/dot-files/blob/master/emacs-org.org#journaling][continue..]]
** main settings
#+BEGIN_SRC emacs-lisp
  (use-package org
    :diminish abbrev-mode
    :init
    (setq org-log-done t ;; enable logging when tasks are complete
          org-list-description-max-indent 5
          ;; open code edit buffers in the same window
          org-src-window-setup 'current-window
          org-adapt-indentation nil ;; prevent demoting heading also shifting text inside sections
          org-src-fontify-natively t ;; Pretty code blocks

          org-use-speed-commands t
          org-return-follows-link t
          org-hide-emphasis-markers t
          org-outline-path-complete-in-steps nil
          org-src-tab-acts-natively t

          org-confirm-babel-evaluate nil
          org-todo-keywords '((sequence "TODO" "INPROGRESS" "DONE"))
          org-todo-keyword-faces '(("INPROGRESS" . (:foreground "blue" :weight bold))))

    :hook ((org-mode . org-indent-mode)
           (org-mode . abbrev-mode)
           ;; (org-mode . flyspell-mode) ;; (add-hook 'org-mode-hook (lambda () (flyspell-mode)))
           (org-mode . auto-fill-mode))

    :config
    (use-package org-bullets
      :hook (org-mode . org-bullets-mode))

    ;; handling errors
    :catch (lambda (keyword err)
             (message (error-message-string err))))

  ;; there is also *org-agenda* and *org-habit* setup in this tut, but i skipped it for now
#+END_SRC

** org-babel
embedd languages inside .org files with proper font-locking
Allows to extract and execute code.
#+BEGIN_SRC emacs-lisp
  ;; (require 'ob) ;; don't know if that's needed, seems not

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((js . t)
     ;; commented line below cuz dunno how to maintain both for now (FIX)
     ;; (shell . t) ;; 'sh' on ubuntu, 'shell' on windows
     (C . t)))
#+END_SRC

** agenda/todo setup
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files (quote ("~/Desktop/todo.org"))) ;; dunno if it's gonna work

  ;; keybindings
  (evil-leader/set-key
    "oc" 'org-capture
    "oa" 'org-agenda)

  ;;set priority range from A to C with default A
  (setq org-highest-priority ?A)
  (setq org-lowest-priority ?C)
  (setq org-default-priority ?A)

  ;;set colours for priorities
  (setq org-priority-faces '((?A . (:foreground "#F0DFAF" :weight bold))
                             (?B . (:foreground "LightSteelBlue"))
                             (?C . (:foreground "OliveDrab"))))

  ;;open agenda in current window
  (setq org-agenda-window-setup (quote current-window))

  (setq org-capture-templates
        '(("t" "todo" entry (file+headline "~/Desktop/todo.org" "Tasks")
           "* TODO [#A] %?\nSCHEDULED: %(org-insert-time-stamp (org-read-date nil t \"+0d\"))\n")))

  ;; org-mode agenda options

  (setq org-deadline-warning-days 7) ;; warn of any deadlines in next 7 days
  (setq org-agenda-span (quote fortnight)) ;;show tasks scheduled in next fortnight
  (setq org-agenda-skip-scheduled-if-deadline-is-shown t)
  (setq org-agenda-skip-deadline-prewarning-if-scheduled (quote pre-scheduled))
  ;;don't show tasks that are scheduled or have deadlines in the normal todo list
  (setq org-agenda-todo-ignore-deadlines (quote all))
  (setq org-agenda-todo-ignore-scheduled (quote all))

  ;;sort tasks in order of when they are due and then by priority
  (setq org-agenda-sorting-strategy
    (quote
     ((agenda deadline-up priority-down)
      (todo priority-down category-keep)
      (tags priority-down category-keep)
      (search category-keep))))
#+END_SRC

** snippets
now after typing '<el TAB' u will get code block with 'emacs-lisp' src
#+BEGIN_SRC emacs-lisp
  (add-to-list 'org-structure-template-alist
	       '("el" "#+BEGIN_SRC emacs-lisp\n?\n#+END_SRC"))
#+END_SRC

* Markdown
#+BEGIN_SRC emacs-lisp
  (use-package markdown-mode
    :mode (("README\\.md\\'" . gfm-mode)
           ("\\.md\\'" . markdown-mode)
           ("\\.markdown\\'" . markdown-mode))
    :init
    ;; use a custom css file to make it a little prettier
    ;; (setq markdown-css-paths `(expand-file-name "markdown.css" sads/vendor-dir))

    ;; generate HTML previews from within the mode
    ;; (setq markdown-command "pandoc --smart -f markdown -t html"))
    (setq markdown-command "markdown"))
#+END_SRC

* IVY | [[https://oremacs.com/swiper/][manual]]
  [[https://www.masteringemacs.org/article/introduction-to-ido-mode][ido]] | helm | ivy -- 3 different ways
** IVY enable
[[https://github.com/abo-abo/swiper#counsel][counsel setup]]
M-o (ivy-dispatching-done) presents available actions for selection, calls it after selection, and then exits.
C-M-o (ivy-dispatching-call) presents available actions for selection, calls it after selection, and then does not exit.
#+BEGIN_SRC emacs-lisp
  (use-package counsel
    :diminish counsel-mode
    :diminish ivy-mode
    :bind ("C-s" . swiper) ;; 'M-r' - toggle fuzzy search in swiper
    :init
    (counsel-mode)
    (ivy-mode)
    :config
    (use-package flx)
    (setq ivy-use-virtual-buffers t
          ;; (setq ivy-count-format "(%d/%d) ")
          ivy-count-format ""
          ivy-initial-inputs-alist nil
          ivy-re-builders-alist '((t . ivy--regex-fuzzy))))
#+END_SRC

** Smex
*Package to get completion in ~M-x~ menu (and most used commands will be at top)*
#+BEGIN_SRC emacs-lisp
  (use-package smex
    :init (smex-initialize)
    :bind ("M-X" . smex-major-mode-commands))

  ;; (setq smex-save-file (expand-file-name ".smex-items" user-emacs-directory))
#+END_SRC

* Projectile | [[https://github.com/howardabrams/dot-files/blob/master/emacs.org#block-wrappers][source]]
#+BEGIN_SRC emacs-lisp
  (use-package projectile
    :diminish projectile-mode
    :init
    (projectile-global-mode 1)
    (setq projectile-keymap-prefix (kbd "C-x p"))
    (evil-leader/set-key "pf" 'projectile-find-file)
    ;; rebind this to some leader keys
    ;; ("C-x p s" . projectile-ag)
    :bind (("C-x p p" . projectile-switch-project)
           ("C-x p g" . projectile-grep)
           ("C-x p R" . projectile-regenerate-tags))
    :commands projectile-ag
    :config
    (setq projectile-switch-project-action 'projectile-commander
          projectile-completion-system 'ivy
          projectile-create-missing-test-files t)
    ;; (add-to-list 'projectile-globally-ignored-files ".DS_Store")

    (def-projectile-commander-method ?d
      "Open project root in dired."
      (projectile-dired))

    (def-projectile-commander-method ?s
      "Open a *shell* buffer for the project."
      (projectile-run-shell))

    (def-projectile-commander-method ?F
      "Git fetch."
      (magit-status)
      (call-interactively #'magit-fetch-current)))
#+END_SRC

* Company
[[https://github.com/company-mode/company-mode/issues/68#issuecomment-36208504][company vs auto-complete]]

#+BEGIN_SRC emacs-lisp
  (use-package company :defer t :diminish
    :init
    (setq company-idle-delay 0.3
          company-dabbrev-ignore-case t
          company-selection-wrap-around t)
    (global-company-mode)
    :config
    (defun org-keyword-backend (command &optional arg &rest ignored)
      "Company backend for org keywords.
  COMMAND, ARG, IGNORED are the arguments required by the variable
  `company-backends', which see."
      (interactive (list 'interactive))
      (cl-case command
        (interactive (company-begin-backend 'org-keyword-backend))
        (prefix (and (eq major-mode 'org-mode)
                     (let ((p (company-grab-line "^#\\+\\(\\w*\\)" 1)))
                       (if p (cons p t)))))
        (candidates (mapcar #'upcase
                            (cl-remove-if-not
                             (lambda (c) (string-prefix-p arg c))
                             (pcomplete-completions))))
        (ignore-case t)
        (duplicates t)))
    (add-to-list 'company-backends 'org-keyword-backend)

    (set (make-local-variable 'company-backends) '(company-css company-web-html company-yasnippet company-files))
    (define-key company-active-map (kbd "ESC") 'company-abort)
    (define-key company-active-map [tab] 'company-complete-common-or-cycle)
    (define-key company-active-map (kbd "C-n") 'company-select-next)
    (define-key company-active-map (kbd "C-p") 'company-select-previous))
#+END_SRC

* Switch-window
alternative - 'Ace-window'

#+BEGIN_SRC emacs-lisp
  (use-package switch-window
    :config
    (setq switch-window-input-style 'minibuffer
          switch-window-increase 4
          switch-window-threshold 2 ;; after how many windows will this pop up
          switch-window-shortcut-style 'qwerty
          switch-window-qwerty-shortcuts '("a" "s" "d" "f" "j" "k" "l"))
    :bind
    ([remap other-window] . switch-window)) ;; remap default funciton with 'switch-window'
#+END_SRC

* Dmenu
~<leader> d~ - runs small terminal for launching applications (run and type 'discord')
#+BEGIN_SRC emacs-lisp
  (use-package dmenu
    :init (evil-leader/set-key "d" 'dmenu))
#+END_SRC
* Popup-kill-ring
~M-y~ - get popup with things u previously deleted..
~C-n/p~ - cycle through them
#+BEGIN_SRC emacs-lisp
  (use-package popup-kill-ring
    :bind ("M-y" . popup-kill-ring))
#+END_SRC
* Sudo-edit
#+BEGIN_SRC emacs-lisp
  (use-package sudo-edit
    :bind ("s-f" . sudo-edit))
#+END_SRC

* Perspective | [[https://github.com/nex3/perspective-el][github]]
workflow common commands:
- C-x x P to investigate a new project with its new perspective (this
also saves off whatever I was doing)
- C-x x x switches to whatever I was doing before
- C-x x s switches to a project’s perspective based on its name

in order to use persp-switch-project and see only project buffers in 'switch-buffer' menu install back ido
from [[https://github.com/Seme4eg/emacs_init/commit/2620f1a411c159cd6c7a7fac84a62839560766c5][this commit]] and bind ',bp' to 'ido-switch-buffer' ([[https://github.com/bbatsov/persp-projectile][link]])

#+BEGIN_SRC emacs-lisp
  ;; this might once come handy
  ;; (evil-leader/set-key "cs" 'window-configuration-to-register)
  ;; (evil-leader/set-key "cr" 'jump-to-register)

  (use-package perspective
    :demand t
    :init
    (define-key evil-normal-state-map (kbd ",z") 'perspective-map)
    (persp-mode 1)
    (use-package persp-projectile
      :init (define-key evil-normal-state-map (kbd ",zP") 'projectile-persp-switch-project))
    :config
    (setq persp-state-default-file "~/.emacs.d/perspectives")
    (add-hook 'kill-emacs-hook #'persp-state-save)
    (define-key perspective-map (kbd "l") 'persp-state-load)
    (define-key perspective-map (kbd "x") 'persp-switch-last)
    (define-key evil-normal-state-map (kbd "gt") 'persp-next)
    (define-key evil-normal-state-map (kbd "gT") 'persp-prev))
#+END_SRC


* Development
** Web-mode | [[web-mode.org][documentation]]
#+BEGIN_SRC emacs-lisp
  (use-package web-mode
    :defer t
    :config
    (setq web-mode-style-padding 2
          web-mode-script-padding 2
          web-mode-markup-indent-offset 2
          web-mode-css-indent-offset 2
          web-mode-code-indent-offset 2
          web-mode-attr-indent-offset t
          web-mode-sql-indent-offset 2
          web-mode-indent-style 2
          web-mode-enable-current-column-highlight t
          web-mode-enable-current-element-highlight t)

    (define-key web-mode-map (kbd "C-n") 'web-mode-tag-match)

    (add-to-list 'auto-mode-alist '("\\.html?\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.php\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.css?\\'" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.js$" . web-mode))
    (add-to-list 'auto-mode-alist '("\\.vue$" . web-mode))

    ;; set up per-language ac-sources FIX
    ;;  (setq web-mode-ac-sources-alist
    ;;	'(("php" . (ac-source-php-extras ac-source-yasnippet ac-source-php-auto-yasnippets))
    ;;	  ("css" . (ac-source-css-property ac-source-emmet-css-snippets))))

    (add-hook 'web-mode-hook
              (lambda ()
                (yas-minor-mode t)
                (emmet-mode)
                ;; (flycheck-add-mode 'html-tidy 'web-mode)
                (flycheck-add-mode 'web-mode)
                (flycheck-mode)))

    (add-hook 'web-mode-before-auto-complete-hooks
              '(lambda ()
                 (let ((web-mode-cur-language (web-mode-language-at-pos)))
                   (if (string= web-mode-cur-language "php")
                       (yas-activate-extra-mode 'php-mode)
                     (yas-deactivate-extra-mode 'php-mode))
                   (if (string= web-mode-cur-language "css")
                       (setq emmet-use-css-transform t)
                     (setq emmet-use-css-transform nil)))))
    )
#+END_SRC

** JS settings
*** js2-mode | [[https://github.com/mooz/js2-mode][github]]
Improved JavaScript editing mode for GNU Emacs

#+BEGIN_SRC emacs-lisp
  (use-package js2-mode
    :init
    (setq-default js2-basic-indent 2
                  js2-basic-offset 2
                  js2-auto-indent-p t
                  js2-cleanup-whitespace t
                  js2-enter-indents-newline t
                  js2-indent-on-enter-key t
                  js2-global-externs (list "window" "module" "require" "buster" "sinon" "assert" "refute" "setTimeout" "clearTimeout" "setInterval" "clearInterval" "location" "__dirname" "console" "JSON" "jQuery" "$"))
    :config
    (setq js2-strict-missing-semi-warning nil)
    (setq js2-missing-semi-one-line-override t)
    ;; (add-to-list 'auto-mode-alist '("\\.jsx?\\'" . js2-jsx-mode))
    (add-to-list 'interpreter-mode-alist '("node" . js2-jsx-mode))
    (add-to-list 'auto-mode-alist '("\\.js$" . js2-mode)))
#+END_SRC

*** tern
The [[https://ternjs.net/doc/manual.html#emacs][Tern]] project is a JavaScript analyzer that can be used to improve the JavaScript integration with editors like Emacs.

First install tern : ~npm i -g tern~ (install globally)

~,tf~ - Jump to the definition of the thing under the cursor.
~,tp~ - Brings you back to last place you were when you pressed M-..
~C-c C-r~ - Rename the variable under the cursor.
~C-c C-c~ - Find the type of the thing under the cursor.
~C-c C-d~ - Find docs of the thing under the cursor. Press again to open the associated URL (if any).
#+BEGIN_SRC emacs-lisp
  (use-package tern
     :init
     (add-hook 'js2-mode-hook (lambda () (tern-mode t)))
     (evil-leader/set-key
       "th" 'tern-highlight-refs
       "tf" 'tern-find-definition
       "tn" 'tern-find-definition-by-name
       "tp" 'tern-pop-find-definition)
     :config
       (use-package company-tern
          :init (add-to-list 'company-backends 'company-tern)))
#+END_SRC

*** js2-refactor | [[https://github.com/magnars/js2-refactor.el][github (shortcuts)]]
#+BEGIN_SRC emacs-lisp
  (use-package js2-refactor
    :init
    (add-hook 'js2-mode-hook #'js2-refactor-mode)
    :config
    (js2r-add-keybindings-with-prefix "C-c b")
    (define-key key-translation-map (kbd ",r") (kbd "C-c b")))
#+END_SRC

** Vue-mode
#+BEGIN_SRC emacs-lisp
    (use-package vue-mode
      :config
      (add-to-list 'auto-mode-alist '("\\.vue$" . vue-mode)))
#+END_SRC

** Skewer | [[https://github.com/skeeto/skewer-mode][github]]
Kick things off with ~run-skewer~, and then:

~C-x C-e~ - `skewer-eval-last-expression’
~C-M-x~ - `skewer-eval-defun’
~C-c C-k~ - `skewer-load-buffer’
#+BEGIN_SRC emacs-lisp
  (use-package skewer-mode
    :init
    (add-hook 'js2-mode-hook 'skewer-mode)
    (add-hook 'css-mode-hook 'skewer-css-mode)
    (add-hook 'html-mode-hook 'skewer-html-mode))
#+END_SRC

** color-identifiers-mode
#+BEGIN_SRC emacs-lisp
  (use-package color-identifiers-mode
    :hook prog-mode)
#+END_SRC

** Smartparents | [[https://github.com/Fuco1/smartparens][github]]
[[https://github.com/expez/evil-smartparens][evil-smartparents github]] and smartparents [[https://www.youtube.com/watch?v=ykjRUr7FgoI&list=PLP6Xwp2WTft7rAMgVPOTI2OE_PQlKGPy7&feature=plpp_play_all][video tutorial]]

~C-M-Space {key}~ - wrap region (or just try pressing {key} when region is active)
#+BEGIN_SRC emacs-lisp
  (use-package smartparens
    :init (add-hook 'prog-mode-hook 'smartparens-mode)
    (use-package evil-smartparens
      :init (add-hook 'smartparens-enabled-hook #'evil-smartparens-mode))
    (evil-leader/set-key
      "s(" 'sp-backward-unwrap-sexp ;; unwrap parent expression
      "s)" 'sp-unwrap-sexp ;; unwrap current expression
      "su" 'sp-splice-sexp ;; unwrap current expression
      "s]" 'sp-forward-slurp-sexp ;; [foo bar] baz --> [foo bar baz]
      "s[" 'sp-forward-barf-sexp ;; [foo bar baz] --> [foo bar] baz
      "ss" 'sp-transpose-sexp ;; "foo" and "bar" to trade places
      "sn" 'sp-forward-sexp ;; move to next expression
      "sp" 'sp-backward-sexp) ;; move to next expression
    )
#+END_SRC

** Flycheck | [[https://www.flycheck.org/en/latest/][guide]]
check also [[https://github.com/howardabrams/dot-files/blob/master/emacs.org#spell-checking][this]] setup later

to use eslint install it: ~npm i -g eslint~

#+BEGIN_SRC emacs-lisp
  ;; 'npm install eslint' for flycheck to support syntax checking for jt
  (use-package flycheck
    :diminish flyspell-mode
    :init
    (setq ispell-program-name "C:/Program Files (x86)/Aspell/bin/aspell.exe"
          ispell-list-command "--list")

    ;; (global-flycheck-mode)
    ;; (add-hook 'prog-mode-hook 'flyspell-prog-mode) ;; for now stick to this variant
    (add-hook 'prog-mode-hook 'flycheck-mode)

    ;; FIX
    ;; (add-hook 'js2-mode-hook
    ;;           (lambda () (flycheck-select-checker "javascript-eslint")))
    (evil-leader/set-key
      "fb" 'flycheck-buffer
      "fc" 'flycheck-clear
      "fn" 'flycheck-next-error
      "fp" 'flycheck-previous-error
      "fs" 'flycheck-list-errors)
    )
#+END_SRC

** Emmet-mode | [[https://github.com/smihica/emmet-mode][github]]
#+BEGIN_SRC emacs-lisp
  (use-package emmet-mode
    :hook (sgml-mode css-mode)
    :commands emmet-mode
    :init
    (setq
     emmet-indentation 2
     emmet-move-cursor-between-quotes t))
#+END_SRC

** Magit
#+BEGIN_SRC emacs-lisp
  (use-package magit
    :init
    (evil-leader/set-key
      "gi" 'magit-init
      "gs" 'magit-status))
#+END_SRC

** Yasnippet
#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :config
    (use-package yasnippet-snippets)
    (yas-reload-all) ;; ur custom snippets won't work untill u run this
    (add-hook 'prog-mode-hook #'yas-minor-mode))
#+END_SRC


* Set up -->
** G[g]tags | [[https://github.com/leoliu/ggtags][github]]

[[https://github.com/howardabrams/dot-files/blob/master/emacs.org#tag-support][another option]]

#+BEGIN_SRC emacs-lisp
  ;; == trying to make ggtags work ==
  ;; (use-package ggtags
  ;;   :hook (prog-mode . ggtags-mode))


  ;; (when (and (maybe-require-package 'gtags)
  ;;            (maybe-require-package 'bpr))
  ;;   ;; Bind some useful keys in the gtags select buffer that evil overrides.
  ;;   (add-hook 'gtags-select-mode-hook
  ;;             (lambda ()
  ;;               (evil-define-key 'normal gtags-select-mode-map (kbd "RET") 'gtags-select-tag)
  ;;               (evil-define-key 'normal gtags-select-mode-map (kbd "q") 'kill-buffer-and-window)))
  ;;
  ;; (provide 'init-gtags)

  ;; === or

  ;; (use-package gtags
  ;;   :init
  ;;   ;; Bind some useful keys in the gtags select buffer that evil overrides.
  ;;   (add-hook 'gtags-select-mode-hook
  ;;             (lambda ()
  ;;               (evil-define-key 'normal gtags-select-mode-map (kbd "RET") 'gtags-select-tag)
  ;;               (evil-define-key 'normal gtags-select-mode-map (kbd "q") 'kill-buffer-and-window))))

  ;; === functions:
  ;;
  ;; (defun gtags-reindex ()
  ;;   "Kick off gtags reindexing."
  ;;   (interactive)
  ;;   (let* ((root-path (expand-file-name (vc-git-root (buffer-file-name))))
  ;;          (gtags-filename (expand-file-name "GTAGS" root-path)))
  ;;     (if (file-exists-p gtags-filename)
  ;;         (gtags-index-update root-path)
  ;;       (gtags-index-initial root-path))))
  ;;
  ;; (defun gtags-index-initial (path)
  ;;   "Generate initial GTAGS files for PATH."
  ;;   (let ((bpr-process-directory path))
  ;;     (bpr-spawn "gtags")))
  ;;
  ;; (defun gtags-index-update (path)
  ;;   "Update GTAGS in PATH."
  ;;   (let ((bpr-process-directory path))
  ;;     (bpr-spawn "global -uv"))))
#+END_SRC

** Eshell
#+BEGIN_SRC emacs-lisp
  ;; (require 'f)
  ;;
  ;; (setq eshell-visual-commands
  ;;       '("less" "tmux" "htop" "top" "bash" "zsh" "fish"))
  ;;
  ;; (setq eshell-visual-subcommands
  ;;       '(("git" "log" "l" "diff" "show")))
  ;;
  ;; ;; Prompt with a bit of help from http://www.emacswiki.org/emacs/EshellPrompt
  ;; (defmacro with-face (str &rest properties)
  ;;   `(propertize ,str 'face (list ,@properties)))
  ;;
  ;; (defun eshell/abbr-pwd ()
  ;;   (let ((home (getenv "HOME"))
  ;;         (path (eshell/pwd)))
  ;;     (cond
  ;;      ((string-equal home path) "~")
  ;;      ((f-ancestor-of? home path) (concat "~/" (f-relative path home)))
  ;;      (path))))
  ;;
  ;; (defun eshell/my-prompt ()
  ;;   (let ((header-bg "#161616"))
  ;;     (concat
  ;;      (with-face (eshell/abbr-pwd) :foreground "#008700")
  ;;      (if (= (user-uid) 0)
  ;; 	 (with-face "#" :foreground "red")
  ;;        (with-face "$" :foreground "#2345ba"))
  ;;      " ")))
  ;;
  ;; (setq eshell-prompt-function 'eshell/my-prompt)
  ;; (setq eshell-highlight-prompt nil)
  ;; (setq eshell-prompt-regexp "^[^#$\n]+[#$] ")
  ;;
  ;; (setq eshell-cmpl-cycle-completions nil)
  ;;

     ;; (setenv "PATH" (concat "/usr/local/bin:/opt/local/bin:/usr/bin:/bin" (getenv "PATH")))

       ;; Terminal setup (stop prompt appearing each time when starting 'ansi-term')
       ;; (defvar my-term-shell "/bin/bash")
       ;; (defadvice ansi-term (before force-bash)
       ;;   (interactive (list my-term-shell)))
       ;; (ad-activate 'ansi-term)


#+END_SRC

** ag frontend
#+BEGIN_SRC emacs-lisp
  ;; (use-package ag
  ;;   :commands  ag
  ;;   :init      (setq ag-highlight-search t)
  ;;   :config    (add-to-list 'ag-arguments "--word-regexp"))
#+END_SRC


* User functions
** Config edit/reload
#+BEGIN_SRC emacs-lisp
  ;; edit
  (defun config-visit()
    (interactive)
    ;; (find-file "~/.emacs.d/config/config.org"))
    (find-file "~/.emacs.d/config/config.org"))
  (global-set-key (kbd "C-c e") 'config-visit)

  ;; reload
  (defun config-reload()
    (interactive)
    (org-babel-load-file (get-fullpath "config/config.org")))
  (global-set-key (kbd "C-c r") 'config-reload)
#+END_SRC
** Identation & buffer cleanups
This re-indents, untabifies, and cleans up whitespace
#+BEGIN_SRC emacs-lisp
  (defun untabify-buffer ()
    (interactive)
    (untabify (point-min) (point-max)))

  (defun indent-buffer ()
    (interactive)
    (indent-region (point-min) (point-max)))

  (defun cleanup-buffer ()
    "Perform a bunch of operations on the whitespace content of a buffer."
    (interactive)
    (indent-buffer)
    (untabify-buffer))

  "Remove tmux artifacts from region."
  (defun cleanup-region (beg end)
    (interactive "r")
    (dolist (re '("\\\\│\·*\n" "\W*│\·*"))
      (replace-regexp re "" nil beg end)))

  (global-set-key (kbd "C-x M-t") 'cleanup-region) ;; make this function autorun when saving 'prog-mode files
#+END_SRC

** Window splitting
#+BEGIN_SRC emacs-lisp
  ;; evil-window-vsplit
  ;; (setq evil-window-split 'split-and-follow-hor)
  (defun evil-window-split()
    (interactive)
    (split-window-below)
    (balance-windows)
    (other-window 1))

  (defun evil-window-vsplit()
    (interactive)
    (split-window-right)
    (balance-windows)
    (other-window 1))
#+END_SRC

** Development
select a region and add wrap it in tag... properly
#+BEGIN_SRC emacs-lisp
  (defun surround-html (start end tag)
     "Wraps the specified region (or the current 'symbol / word'
   with a properly formatted HTML tag."
     (interactive "r\nsTag: " start end tag)
     (save-excursion
       (narrow-to-region start end)
       (goto-char (point-min))
       (insert (format "<%s>" tag))
       (goto-char (point-max))
       (insert (format "</%s>" tag))
       (widen)))

  (define-key html-mode-map (kbd "C-c C-t") 'surround-html)
#+END_SRC
** Other f-s
#+BEGIN_SRC emacs-lisp
  (defun kill-all-buffers ()
    (interactive)
    (mapc 'kill-buffer (buffer-list))) ;; loop thrue list
  ;; set kbd if u will use it often

  (defun sad/insert-line-before (times)
    ;; insert a line 'above' cur. cursor position
    (interactive "p")
    (save-excursion
      (move-beginning-of-line 1)
      (newline times)))

  (global-set-key (kbd "C-S-o") 'sad/insert-line-before) ;; `C-6 {binded kbd}`
#+END_SRC
